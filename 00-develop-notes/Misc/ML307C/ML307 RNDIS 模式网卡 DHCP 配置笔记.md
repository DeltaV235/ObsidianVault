---

title: ML307 RNDIS 模式网卡 DHCP 配置笔记
created: 2025-12-19
tags:
  - 嵌入式/4G模组
  - 网络配置/DHCP
  - AT指令
  - ML307系列
  - RNDIS
  - 硬件调试

---

# ML307 RNDIS 模式网卡 DHCP 配置笔记

## 1. 查询当前配置

使用以下指令单独查询 DHCPv4 的当前配置状态及参数。

**指令：**
```asciidoc
AT+MDIALUPCFG="dhcpv4"
```

**响应示例：**
```asciidoc
+MDIALUPCFG: "dhcpv4",1,"192.168.100.1",100,200,86400
OK
```

---

## 2. 设置 DHCP 配置

**指令语法：**
```asciidoc
AT+MDIALUPCFG="dhcpv4",<en>[,<gw_ip>,<start_val>,<end_val>,<time>]
```

**参数详解：**

根据响应示例 `1,"192.168.100.1",100,200,86400` 分析，各参数定义如下：

| 参数位 | 参数名称 | 类型 | 说明 | 配置示例 |
| :--- | :--- | :--- | :--- | :--- |
| **1** | `"dhcpv4"` | 字符串 | 固定关键字，指定配置对象。 | `"dhcpv4"` |
| **2** | `<en>` | 整数 | **服务开关**<br>`0`: 关闭<br>`1`: 开启 | `1` |
| **3** | `<gw_ip>` | 字符串 | **网关 IP / 模组 IP**<br>需使用**双引号**包裹。该 IP 决定了局域网的网段前缀。 | `"192.168.100.1"` |
| **4** | `<start_val>`| 整数 | **地址池起始位**<br>**仅填写数字**（IP 的最后一段 0-255），无需双引号。 | `100` |
| **5** | `<end_val>` | 整数 | **地址池结束位**<br>**仅填写数字**（IP 的最后一段 0-255），无需双引号。 | `200` |
| **6** | `<time>` | 整数 | **租期时间**<br>单位：秒。 | `86400` |

---

## 3. DHCP 地址池分配逻辑

模组根据 `<gw_ip>` 的前三段确定网段,结合 `<start_val>` 和 `<end_val>` 生成 DHCP 地址池的分配范围。

**示例计算：**
若配置为 `"192.168.100.1",100,200`
*   **网段前缀：** `192.168.100.`
*   **分配给电脑的 IP 范围：** `192.168.100.100` ~ `192.168.100.200`

---

## 4. 常用配置场景

### 场景一：仅开启 DHCP（使用默认或已有参数）
```asciidoc
AT+MDIALUPCFG="dhcpv4",1
```

### 场景二：自定义网段配置
**需求：** 设置模组 IP 为 `192.168.10.1`，分配范围 `192.168.10.50` 到 `192.168.10.60`，租期 1 小时。
**指令：**
```asciidoc
AT+MDIALUPCFG="dhcpv4",1,"192.168.10.1",50,60,3600
```
> **注意：** IP 地址要加引号，起始和结束位直接写数字。

### 场景三：关闭 DHCP
**需求：** 电脑端使用静态 IP，无需模组分配。
**指令：**
```asciidoc
AT+MDIALUPCFG="dhcpv4",0
```

---

## 5. 注意事项

1.  **重启生效：** 修改参数后，通常需要重启模组（`AT+CFUN=1,1` 或断电）才能让连接的主机重新通过 DHCP 获取到新的 IP。
2.  **网段一致性：** `<gw_ip>` 的网段决定了整个局域网的网段。
3.  **冲突避免：** 请确保 `<gw_ip>` 的最后一位数字**不在** `<start_val>` 和 `<end_val>` 的区间内,防止模组 IP 与分配给电脑的 IP 冲突。
    *   **正确示例：** `"192.168.100.1",100,200` (网关是 .1,分配范围 .100~.200,不冲突)
    *   **错误示例：** `"192.168.100.150",100,200` (网关是 .150,在分配范围内,会冲突!)