---

title: 跨平台 .local 域名解析差异与解决方案
created: 2025-11-17
tags:
    - DNS
    - Domain

---

## 🪩 一、问题现象

在网关或本地设置了 `hosts` 文件，将 `domain.local` 指向局域网 IP（例如 `192.168.0.x`）。  

结果：
- 部分 **Windows + Chrome** 正常解析；
- **macOS + Chrome** 无法访问；
- 修改为其他后缀（如 `domain.lan`）后则恢复正常。

---

## ⚙️ 二、根本原因

- macOS 和基于 Darwin 的系统会将 **`.local` 域名保留给 Bonjour / mDNS（多播 DNS）** 使用；
  - `.local` 被视为局域网自动发现域，不走普通 DNS 或 hosts；
- Windows 通常会按 hosts 或 DNS 解析 `.local`；
  - 但某些机器启用了 **DoH（安全DNS）**、**LLMNR** 等功能，也可能导致解析不一致。

---

## 🧠 三、验证方法
在 macOS 终端执行：
```bash
ping domain.local
```
若提示 “Unknown host” 或解析到 `169.254.x.x` 地址，则说明系统走了 mDNS。

可进一步查看 DNS 配置来源：
```bash
sudo scutil --dns | grep domain.local
```

---

## 🪛 四、解决方案

| 方案 | 说明 |
|------|------|
| ✅ **推荐** | 使用非保留域，如 `.lan`、`.internal`、`.test`，确保跨系统一致 |
| ⚠️ 临时方案 | 关闭 macOS 的 mDNSResponder（不推荐，影响 AirDrop/AirPlay 等功能） |
| 🧹 辅助优化 | 清理浏览器和系统 DNS 缓存，关闭 Secure DNS (DoH) 以防冲突 |

---

## 🧯 五、Windows 排查项
- 关闭 **Secure DNS (Chrome → 安全 → 关闭安全 DNS)**  
- 执行：
  ```
  ipconfig /flushdns
  ```
- 关闭本地 LLMNR：
  ```
  组策略 → 计算机配置 → 管理模板 → 网络 → DNS客户端 → 关闭多播名称解析
  ```

---

## 🧩 六、结论
- macOS 的 `.local` 不受 hosts 控制，是由 mDNS 接管的；
- Windows 对 `.local` 行为不固定；
- **统一使用 `.lan` 或 `.internal` 可彻底解决跨平台解析不一致的问题。**

---

👉 **经验总结：**  
> 永远避免在跨平台环境中使用 `.local` 域名作为自定义内部解析域。
