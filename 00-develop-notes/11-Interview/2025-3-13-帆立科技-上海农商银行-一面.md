---

title: 2025-3-14-帆立科技-上海农商银行-一面
created: 2025-03-16
tags:
    - Interview

---

Q：项目中遇到过哪些生产问题？
A：永久代溢出。

Q：如果在调用下游 API 的时候服务宕机了怎么办？

Q：进入 MQ 的消息一定能被消费吗？不能的话怎么解决？

Q：如何匀速限流？

Q：

Q：如下代码的 `sendMsg()` 可能会被执行多次，找出所有可能的原因
A：

1. `if(!lock) return;` 会使未持有分布式锁的请求在 finally 块中不正确的释放该锁
2. 先解锁，后提交事务，导致同一次 IP 变更可能出发多次 `sendMsg()`
3. `@Transactional` 的默认传播行为是 `REQUIRED`，无法保证方法执行结束后就立即提交 DB 变更

修改方式：

1. 将 `if(!lock) return;` 移到 try 上方
2. 在外层再抽象一个方法，将加锁解锁的逻辑放在外层方法中
3. 将 `@Transactional` 的传播行为改为 `REQUIRES_NEW`，保证方法执行结束后就立即提交 DB 变更
4. 将 `@Async` 移动到外部方法上

![[截屏2025-03-13 20.06.19.png]]
